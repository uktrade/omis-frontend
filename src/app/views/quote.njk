{% extends '_layouts/omis-base.njk' %}

{% block body_main_content %}
  <p>
    <a href="/{{ publicToken }}">Back to summary</a>
  </p>

  {% if invalid %}
    {{ ErrorSummary({
      messages: {
        confirm: 'Accept the terms and conditions'
      }
    }) }}
  {% endif %}

  <h1>Your quote ({{ order.reference }})</h1>

  {{ MetaList({
    items: [
      { label: 'We sent it on', value: quote.created_on, type: 'datetime' },
      { label: 'Purchase order (PO) number', value: order.po_number }
    ],
    itemModifier: 'stacked'
  }) }}

  {% if quote.cancelled_on %}
    {% call Message({ type: 'error', element: 'div' }) %}
      <p>This quote is no longer valid.</p>
      <p>Get in touch with your DIT contact or email <a href="mailto:omis.orders@digital.trade.gov.uk">omis.orders@digital.trade.gov.uk</a></p>
    {% endcall %}
  {% else %}
    {% if quote.accepted_on %}
      {{ Message({
        type: 'success',
        text: 'You accepted this quote on ' + quote.accepted_on | formatDateTime
      }) }}
    {% endif %}

    {% if not quote.accepted_on %}
      {% call Message({
        type: 'error' if quote.expired else 'info',
        element: 'div'
      }) %}
        <p>This quote {{ 'expired' if quote.expired else 'will expire' }} on {{ quote.expires_on | formatDate }} ({{ quote.expires_on | fromNow }}).</p>
        {% if quote.expired %}
          <p>Get in touch with your DIT contact or email <a href="mailto:omis.orders@digital.trade.gov.uk">omis.orders@digital.trade.gov.uk</a></p>
        {% endif %}
      {% endcall %}
    {% endif %}
  {% endif %}

  {% if quote.content %}
    <article class="example">
      <div class="example__preview l-markdown">
  {% markdown %}{{ quote.content | safe }}{% endmarkdown %}
        {% call Reveal({ summary: 'View full terms and conditions' }) %}
  {# Ugly indentation is so that markdown spacing is handled correctly #}
  {% markdown %}{{ quote.terms_and_conditions | safe }}{% endmarkdown %}
        {% endcall %}
      </div>
    </article>
  {% else %}
    {% call Message({ type: 'muted', element: 'div' }) %}
      <p>
        To view your quote, get in touch with your DIT contact or email <a href="mailto:omis.orders@digital.trade.gov.uk">omis.orders@digital.trade.gov.uk</a>.
      </p>
    {% endcall %}
  {% endif %}

  {% if not quote.expired and not quote.accepted_on and not quote.cancelled_on %}
    <form method="post">
      <input type="hidden" name="_csrf" value="{{ CSRF_TOKEN }}">

      {{ MultipleChoiceField({
        name: 'confirm',
        label: 'Accept the terms and conditions',
        isLabelHidden: true,
        type: 'checkbox',
        options: [{
          value: 'true',
          label: 'I accept the Charges and the Terms and Conditions'
        }],
        error: 'Confirm that you accept the Charges and the Terms and Conditions' if invalid
      }) }}

      <button type="submit" class="button">Accept quote</button>
    </form>

    {% call Reveal({ summary: 'There is a problem with my quote' }) %}
      {% call Message({ type: 'muted' }) %}
        Get in touch with your DIT contact or email <a href="mailto:omis.orders@digital.trade.gov.uk">omis.orders@digital.trade.gov.uk</a>
      {% endcall %}
    {% endcall %}
  {% endif %}
{% endblock  %}
